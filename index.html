<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembe Prenses İnteraktif Mobil Albüm</title>
    <style>
        /* GENEL VE ORTALAMA AYARLAR */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available; 
            margin: 0;
            background-color: #FFC0CB; /* Pembe Arka Plan */
            overflow: hidden; 
            box-sizing: border-box;
            position: relative; /* Sabit butonu konumlandırmak için */
        }
        html {
             height: -webkit-fill-available;
        }
        
        /* KAYDET BUTONU CSS'i */
        #saveButton {
            position: fixed; /* Ekrana sabitler */
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #FF69B4; /* Koyu Pembe */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, transform 0.1s;
            z-index: 1000; /* Her zaman en önde */
        }
        
        #saveButton:hover {
            background-color: #FF1493; /* Hover Rengi */
        }
        
        #saveButton:active {
            transform: scale(0.98);
        }

        /* KAYDET ONAY MESAJI */
        #saveMessage {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: #4CAF50; /* Yeşil */
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none; /* Tıklama olaylarını engeller */
        }

        /* ALBÜM ANA KONTEYNERİ (Responsive) */
        .album-container {
            perspective: 1500px; 
            cursor: pointer;
            width: 80vw; 
            max-width: 500px; 
            height: calc(80vw * 1.2); 
            max-height: 600px; 
            position: relative; 
        }

        /* Sayfalar (Kapak dahil) */
        .book-page {
            width: 100%; 
            height: 100%; 
            position: absolute;
            top: 0;
            left: 0;
            background-size: cover;
            background-position: center;
            border: 3px solid #fff; 
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transition: transform 1s ease-in-out; 
            transform-origin: left center;
            backface-visibility: hidden; 
            background-image: url('page.png');
        }
        
        #page-0 {
            z-index: 22;
            background-image: url('cover.png');
            background-size: cover;
        }

        /* İÇERİK DÜZENİ */
        .page-content {
            padding: 4%; 
            height: 100%;
            display: grid;
            grid-template-rows: 2fr 2fr auto; 
            gap: 1.5vw; 
        }

        .image-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5vw;
        }

        .image-placeholder {
            width: 100%;
            padding-top: 100%;
            position: relative;
            background-color: #eee;
            background-size: cover;
            background-position: center;
            border: 2px dashed #FF69B4; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: cell; 
            font-size: 0.7em; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .image-placeholder:empty::before {
            content: "Tıkla & Resim Ekle";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }
        
        .note-area {
            height: 10vh; 
            min-height: 40px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #FF69B4;
            font-size: 14px;
            cursor: text; 
            margin-top: 10px;
            text-align: center;
        }

        /* ANIMASYON SINIFLARI */
        .page-turn {
            transform: rotateY(-180deg) !important;
            z-index: 100 !important; 
        }

        .active-page {
            z-index: 21; 
            visibility: visible;
        }

        .hidden-page {
             visibility: hidden;
        }

        .file-input-hidden {
            display: none;
        }

        /* MOBİL OPTİMİZASYON (MEDIA QUERY) */
        @media (max-width: 600px) {
            .album-container {
                width: 90vw; 
                height: calc(90vw * 1.2); 
            }
            .image-placeholder:empty::before {
                font-size: 0.6em;
            }
        }
    </style>
</head>
<body>

    <button id="saveButton">Değişiklikleri Kaydet</button>
    <div id="saveMessage">Kaydedildi!</div>

    <div class="album-container" id="albumContainer">
        
        <div id="page-0" class="book-page"></div>
        
        </div>

    <audio id="pageTurnAudio" src="page.mp3" preload="auto"></audio>
    <audio id="classicMusicAudio" src="classic.mp3" preload="auto" loop></audio>

    <script>
        const TOTAL_PAGES = 20;
        const albumContainer = document.getElementById('albumContainer');
        const pageTurnSound = document.getElementById('pageTurnAudio');
        const classicMusic = document.getElementById('classicMusicAudio');
        const saveButton = document.getElementById('saveButton');
        const saveMessage = document.getElementById('saveMessage'); // Yeni
        let currentPageIndex = 0; 
        const pages = [document.getElementById('page-0')];
        
        let ALBUM_DATA = JSON.parse(localStorage.getItem('albumData')) || [];

        if (ALBUM_DATA.length !== TOTAL_PAGES) {
            ALBUM_DATA = [];
            for (let i = 1; i <= TOTAL_PAGES; i++) {
                ALBUM_DATA.push({
                    sayfa: i,
                    resimler: Array(6).fill(null),
                    not: `Sayfa ${i} için not yazmaya buradan başlayın.`
                });
            }
            localStorage.setItem('albumData', JSON.stringify(ALBUM_DATA));
        }

        // --- SAYFA YAPISINI OLUŞTURAN FONKSİYONLAR ---

        function saveAlbumData(showFeedback = false) {
            localStorage.setItem('albumData', JSON.stringify(ALBUM_DATA));
            
            // Eğer butona basıldıysa veya özel olarak istendiyse onay göster
            if (showFeedback) {
                saveMessage.style.opacity = 1;
                setTimeout(() => {
                    saveMessage.style.opacity = 0;
                }, 1500);
            }
        }

        // YENİ: KAYDET BUTONU OLAY YÖNETİCİSİ
        saveButton.onclick = function() {
            saveAlbumData(true); // True göndererek onay mesajını göster
        };


        function handleNoteInput(event, pageNumber) {
            ALBUM_DATA[pageNumber - 1].not = event.target.textContent;
            saveAlbumData(); // Otomatik kaydet
        }

        function handleImageUpload(event, pageNumber, resimIndex) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                ALBUM_DATA[pageNumber - 1].resimler[resimIndex] = e.target.result;
                saveAlbumData(); // Otomatik kaydet
                
                const placeholder = event.target.parentNode;
                placeholder.style.backgroundImage = `url('${e.target.result}')`;
                placeholder.textContent = ''; 
                placeholder.style.borderStyle = 'solid'; 
            };
            reader.readAsDataURL(file);
        }

        function createPageContent(pageNumber, data) {
            const pageEl = document.createElement('div');
            pageEl.id = `page-${pageNumber}`;
            pageEl.className = `book-page hidden-page ${pageNumber === 1 ? 'active-page' : ''}`;
            
            const content = document.createElement('div');
            content.className = 'page-content';
            
            // 2 Resim Sırası
            for (let i = 0; i < 2; i++) {
                const row = document.createElement('div');
                row.className = 'image-row';
                
                // 3 Resim
                for (let j = 0; j < 3; j++) {
                    const resimIndex = (i * 3) + j;
                    
                    const imgPlaceholder = document.createElement('div');
                    imgPlaceholder.className = 'image-placeholder';

                    // Resim Yükleme Inputu
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.className = 'file-input-hidden';
                    fileInput.onchange = (e) => handleImageUpload(e, pageNumber, resimIndex);
                    
                    imgPlaceholder.appendChild(fileInput);

                    if (data.resimler[resimIndex]) {
                         imgPlaceholder.style.backgroundImage = `url('${data.resimler[resimIndex]}')`;
                         imgPlaceholder.style.borderStyle = 'solid';
                    } else {
                         imgPlaceholder.style.borderStyle = 'dashed';
                    }

                    imgPlaceholder.onclick = function() {
                        if (currentPageIndex === pageNumber) { 
                            fileInput.click(); 
                        }
                    };
                    
                    row.appendChild(imgPlaceholder);
                }
                content.appendChild(row);
            }
            
            // Not Alanı
            const noteArea = document.createElement('div');
            noteArea.className = 'note-area';
            noteArea.textContent = data.not;
            noteArea.contentEditable = true;
            noteArea.onblur = (e) => handleNoteInput(e, pageNumber);

            content.appendChild(noteArea);
            pageEl.appendChild(content);
            albumContainer.appendChild(pageEl);
            pages.push(pageEl);
        }

        // TÜM SAYFALARIN İÇERİĞİNİ YÜKLE
        ALBUM_DATA.forEach((data) => {
            createPageContent(data.sayfa, data);
        });


        // --- SAYFA ÇEVİRME KONTROLÜ (Önceki Cevaptaki Çözüm) ---

        function playPageTurnSound() {
            pageTurnSound.currentTime = 0;
            pageTurnSound.play();
        }

        function shouldHandleInteraction(event) {
            // Tıklama hedefi Kaydet butonu veya bir resim/not alanıysa çevirme yapma
            if (event.target.closest('.image-placeholder') || event.target.classList.contains('note-area') || event.target.id === 'saveButton') {
                return false;
            }
            return true;
        }

        function handleInteraction(event) {
            if (shouldHandleInteraction(event)) {
                handlePageTurning();
            }
        }

        // Masaüstü bilgisayarlar için 'click' olayını ekle
        document.getElementById('albumContainer').onclick = handleInteraction;

        // Mobil cihazlar için 'touchend' olayını ekle
        document.getElementById('albumContainer').ontouchend = handleInteraction;


        function handlePageTurning() {
            classicMusic.play().catch(error => {});

            if (currentPageIndex === 0) {
                pages[0].classList.add('page-turn'); 
                pages[1].classList.add('active-page');
                pages[1].classList.remove('hidden-page');
                playPageTurnSound();
                currentPageIndex = 1;
            } else if (currentPageIndex > 0 && currentPageIndex < TOTAL_PAGES) {
                const currentPageEl = pages[currentPageIndex];
                const nextPageEl = pages[currentPageIndex + 1];
                
                currentPageEl.classList.add('page-turn');
                currentPageEl.classList.remove('active-page');
                
                nextPageEl.classList.add('active-page');
                nextPageEl.classList.remove('hidden-page');

                playPageTurnSound();
                currentPageIndex++;
            } else if (currentPageIndex === TOTAL_PAGES) {
                pages[currentPageIndex].classList.add('page-turn');
                pages[currentPageIndex].classList.remove('active-page');
                playPageTurnSound();
                currentPageIndex++;
            } else if (currentPageIndex === TOTAL_PAGES + 1) {
                pages.forEach(page => page.classList.remove('page-turn', 'active-page', 'hidden-page'));
                pages[1].classList.add('active-page'); 
                playPageTurnSound();
                
                setTimeout(() => {
                    pages.forEach(page => {
                        if (page.id !== 'page-0') {
                             page.classList.add('hidden-page');
                        }
                    });
                    currentPageIndex = 0; 
                }, 1000); 
            }
        }
    </script>
</body>
</html>
